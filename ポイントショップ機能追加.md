# ポイントショップ機能追加

## 🎯 追加内容

### **1️⃣ ポイントショップページ**
**`/point-shop`** - ユーザーがポイントを使ってアイテムを購入できるページ

#### **機能**
- ✅ 6種類のアイテムを提供
  - ダークテーマ (100P)
  - ブルーテーマ (150P)
  - 優先通知 (200P)
  - カスタムアバター (300P)
  - プレミアムサポート (500P)
  - 限定バッジ (1000P)
- ✅ レアリティシステム（コモン、レア、エピック、レジェンダリー）
- ✅ 購入確認ダイアログ
- ✅ ポイント不足チェック
- ✅ リアルタイムポイント更新

#### **UI/UX設計**
```
┌─────────────────────────────────────┐
│ 🛒 ポイントショップ                │
│ ポイントを使って特別なアイテムを購入│
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│ 💰 1,000 ポイント [利用可能]       │
└─────────────────────────────────────┘
┌─────────┬─────────┬─────────┐
│ 🌙      │ 🔵     │ 🔔     │
│ ダーク  │ ブルー  │ 優先    │
│ テーマ  │ テーマ  │ 通知    │
│ 100P    │ 150P    │ 200P    │
└─────────┴─────────┴─────────┘
```

### **2️⃣ マイアイテムページ**
**`/my-items`** - ユーザーが購入したアイテムを表示するページ

#### **機能**
- ✅ 購入したアイテムの一覧表示
- ✅ 統計情報（所有アイテム数、総消費ポイント、アクティブアイテム）
- ✅ アイテム詳細（購入日時、消費ポイント、アクティブ状態）
- ✅ 空の状態表示（アイテム未購入時）

#### **統計情報カード**
```
┌─────┬─────┬─────┐
│ 📦  │ 💰  │ ✅  │
│ 5   │ 2,500│ 3   │
│ 所有│ 総消費│ アク│
│ アイ│ ポイント│ ティブ│
└─────┴─────┴─────┘
```

### **3️⃣ 購入API**
**`/api/purchase-item`** - アイテム購入処理

#### **機能**
- ✅ ユーザー認証チェック
- ✅ ポイント不足チェック
- ✅ 購入履歴記録（point_transactions）
- ✅ ユーザーポイント更新
- ✅ ユーザーアイテム所有記録（user_items）

#### **レスポンス例**
```json
{
  "success": true,
  "message": "ダークテーマを購入しました！",
  "purchase": {
    "itemId": "theme_dark",
    "itemName": "ダークテーマ",
    "pointsSpent": 100,
    "previousPoints": 1000,
    "newPoints": 900,
    "purchaseId": "uuid"
  }
}
```

### **4️⃣ マイアイテムAPI**
**`/api/my-items`** - ユーザーのアイテム取得

#### **機能**
- ✅ ユーザー認証チェック
- ✅ 購入したアイテム一覧取得
- ✅ 購入日時順でソート

#### **レスポンス例**
```json
{
  "success": true,
  "items": [
    {
      "id": "uuid",
      "item_id": "theme_dark",
      "item_name": "ダークテーマ",
      "purchased_at": "2024-12-03T10:00:00Z",
      "points_spent": 100,
      "is_active": true
    }
  ],
  "user": {
    "id": "user_id",
    "email": "user@example.com"
  }
}
```

### **5️⃣ データベーステーブル**
**`user_items`** - ユーザーアイテム所有テーブル

#### **スキーマ**
```sql
CREATE TABLE user_items (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  item_id VARCHAR(255) NOT NULL,
  item_name VARCHAR(255) NOT NULL,
  purchased_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  points_spent INTEGER NOT NULL,
  is_active BOOLEAN DEFAULT true,
  metadata JSONB DEFAULT '{}',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### **6️⃣ ナビゲーション統合**

#### **moreページ**
- ✅ ポイントセクション追加
- ✅ ポイントショップボタン
- ✅ マイアイテムボタン

#### **プロフィールページ**
- ✅ ポイント情報セクションにリンク追加
- ✅ ポイントショップリンク
- ✅ マイアイテムリンク

## 🎨 デザイン特徴

### **カラーパレット**
- コモン: #9E9E9E (グレー)
- レア: #2196F3 (ブルー)
- エピック: #9C27B0 (パープル)
- レジェンダリー: #FFD700 (ゴールド)

### **アニメーション**
- ホバー時の浮上効果
- 購入ボタンのローディング状態
- カードのスムーズな遷移

### **レスポンシブデザイン**
- モバイルファースト
- グリッドレイアウト
- タッチフレンドリーなボタンサイズ

## 🔧 技術仕様

### **使用技術**
- Next.js 14 (App Router)
- TypeScript
- Material-UI (MUI)
- Supabase (認証・データベース)
- Vibration API (触覚フィードバック)

### **セキュリティ**
- Row Level Security (RLS)
- ユーザー認証チェック
- ポイント不足防止
- 購入履歴の完全記録

### **パフォーマンス**
- サーバーサイドレンダリング
- 画像の最適化
- 効率的なデータベースクエリ
- キャッシュ戦略

## 🚀 今後の拡張予定

### **機能拡張**
- [ ] アイテムの実際の機能実装
- [ ] アイテムの有効/無効切り替え
- [ ] アイテムの期限設定
- [ ] 限定アイテムの時間制限
- [ ] バンドル商品の追加

### **UI/UX改善**
- [ ] アニメーションの追加
- [ ] サウンドエフェクト
- [ ] 購入成功時の演出
- [ ] アイテムプレビュー機能

### **管理機能**
- [ ] 管理者用アイテム管理画面
- [ ] 売上統計
- [ ] 人気アイテム分析
- [ ] アイテム価格調整機能
